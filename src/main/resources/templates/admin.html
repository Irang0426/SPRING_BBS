<!-- null ê°’ë§Œ ìˆëŠ” í•­ëª© ì •ë ¬í•˜ë ¤ í•  ë•Œ ì˜¤ë¥˜ë‚¨-->
<!-- <!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>íšŒì› ê´€ë¦¬</title>
<style>
  body {
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    margin: 20px;
    background-color: #f9f9f9;
  }

  nav {
    margin-bottom: 10px;
  }

  nav a {
    text-decoration: none;
    color: #333;
    font-weight: bold;
    margin-right: 10px;
  }

  nav a:hover {
    color: #007BFF;
  }

  hr {
    border: none;
    height: 1px;
    background-color: #ccc;
    margin: 20px 0;
  }

  h2 {
    color: #444;
    margin-bottom: 10px;
  }

  select {
    padding: 5px;
    font-size: 14px;
    margin-bottom: 15px;
  }

  table {
    width: 100%;
    border-collapse: collapse;
    background-color: #fff;
    margin-top: 10px;
    box-shadow: 0 2px 5px rgba(0,0,0,0.1);
  }

  th, td {
    padding: 10px;
    border: 1px solid #ddd;
    text-align: center;
  }

  th {
    background-color: #f0f0f0;
    cursor: pointer;
    color: #333;
  }

  th:hover {
    background-color: #e0e0e0;
  }

  .delete-button {
    background-color: #dc3545;
    color: white;
    border: none;
    padding: 6px 12px;
    cursor: pointer;
    border-radius: 4px;
  }

  .delete-button:hover {
    background-color: #c82333;
  }

  .page-nav {
    padding: 10px;
  }

  .page-link {
    text-decoration: none;
    color: #007BFF;
    font-weight: bold;
    cursor: pointer;
  }

  .page-link:hover {
    text-decoration: underline;
  }

  .nowPage a {
    color: white;
    background-color: #007BFF;
    padding: 5px 10px;
    border-radius: 4px;
  }
  
  .control-bar {
	  display: flex;
	  justify-content: space-between;
	  align-items: center;
	  margin-bottom: 15px;
	}

  #insertBoard input[type="text"] {
    padding: 5px;
    margin-right: 5px;
  }

  #insertBoard button, .update-button {
    background-color: #28a745;
    color: white;
    border: none;
    padding: 6px 12px;
    border-radius: 4px;
    cursor: pointer;
  }

  #insertBoard button:hover, .update-button:hover {
    background-color: #218838;
  }
  
  #pageLimitSelect {
	  padding: 5px;
	  font-size: 14px;
	}
</style>
<script th:inline="javascript">
const TableManager = {
  state: {
    sortDirections: [], // ê° ì»¬ëŸ¼ì˜ ì •ë ¬ ë°©í–¥ ('asc' or 'desc')
    sortName: [],       // ì»¬ëŸ¼ ì´ë¦„ ë°°ì—´ (ì„œë²„ì—ì„œ ì“°ì´ëŠ” ì»¬ëŸ¼ëª…)
    lastSorted: 0,		// ë§ˆì§€ë§‰ìœ¼ë¡œ í´ë¦­ëœ ì»¬ëŸ¼ ë²ˆí˜¸
    page: 0,            // í˜„ì¬ í˜ì´ì§€ ë²ˆí˜¸
    limit: 20,          // í•œ í˜ì´ì§€ì— ëª‡ ê°œë¥¼ ë³´ì—¬ì¤„ì§€
    order: "asc",       // í˜„ì¬ ì •ë ¬ ë°©í–¥
    sort: "id",         // í˜„ì¬ ì •ë ¬ ê¸°ì¤€ ì»¬ëŸ¼
    partial: false,		// í…Œì´ë¸” ì „ì²´(ì»¬ëŸ¼)ë¥¼ ë°”ê¿€ì§€ ì•„ë‹ˆë©´ tbodyë§Œ ë°”ê¿€ì§€
    boardName: null, // board ì´ë¦„ ë°›ì•„ì„œ ìƒì„±
    url: "users",		// ë¬´ì—‡ì— ê´€í•œ í…Œì´ë¸”ì¸ì§€
    totalPageCount: -1	// í˜ì´ì§€ ëª‡ê¹Œì§€ ìˆë‚˜, ì´ˆê¸°í™” -1
  },

  // admin.html ì²˜ìŒ ë“¤ì–´ì˜¬ ë•Œ ì´ˆê¸°í™”
  init(url, sortNameArray) {
    this.state.sortName = sortNameArray;
    this.state.sortDirections = new Array(sortNameArray.length).fill("asc");
    this.state.sort = sortNameArray[0];
    this.state.order = "asc";
    this.state.url = url;
    
    document.addEventListener('DOMContentLoaded', () => {
        this.bindDeleteButtons();
    });
  },
  // í…Œì´ë¸” ì¢…ë¥˜ë¥¼ ë°”ê¿€ ë•Œ ë™ì‘ > ajaxë¡œ ë™ì‘
  set(url, sortNameArray) {
    this.state.sortName = sortNameArray;
    this.state.sortDirections = new Array(sortNameArray.length).fill("asc");
    this.state.lastSorted = 0;
    this.state.page = 0;
    this.state.limit = 20;
    this.state.order = "asc";
    this.state.sort = sortNameArray[0];
    this.state.url = url;
    
    this.pageAjax();
  },
  // select option ë³€ê²½ë  ë•Œ
  updateLimitSize(newsize) {
		console.log("newsize: ", newsize);
	if (newsize == 0) {
		console.log("ì‚¬ì´ì¦ˆ ë³€ê²½ ì—†ìŒ");
		return false;
	}
	this.state.limit = newsize;
	this.state.partial = true;
	
	this.pageAjax();
  },
  // ì¹¼ëŸ¼ì„ ëˆ„ë¥´ë©´ ì˜¤ë¦„ì°¨ìˆœ ë‚´ë¦¼ì°¨ìˆœ ë°”ë€œ > ajax
  updateSort(col) {
	this.state.lastSorted = col;
	if (this.state.sortDirections[col] === "desc") {
		this.state.sortDirections[col] = "asc";
	} else if (this.state.sortDirections.includes("desc")) {
		this.state.sortDirections = new Array(this.state.sortName.length).fill("asc");
	} else {
		this.state.sortDirections = new Array(this.state.sortName.length).fill("asc");
		this.state.sortDirections[col] = "desc";
	}
	
	this.state.partial = true;
    this.state.sort = this.state.sortName[col];
    this.state.order = this.state.sortDirections[col];

    this.pageAjax();
  },
  // ajax ë™ì‘ì— ê´€í•œ í•¨ìˆ˜ ì •ë³´ ë°›ì•„ì˜¤ê³  ë³€ìˆ˜ ì •ë¦¬
  pageAjax() {
    const { sort, order, page, limit, url, boardName } = this.state;
	if (this.state.partial) {
    	fetch(`/admin/${url}/partial?sortby=${sort}&orderby=${order}&page=${page}&limit=${limit}&url=${url}`)
	      .then(res => res.text())
	      .then(html => {
	        document.querySelector("tbody").innerHTML = html;
	        this.state.totalPageCount = document.getElementById('totalPageCount').value;
	        this.state.partial = false;
	        this.bindDeleteButtons();
	        this.changeList(this.state.totalPageCount < 0 ? [[${totalPageCount}]] : this.state.totalPageCount);
	        this.bindUpdateButtons();
	        this.updateSortIcons();
	      });
	} else {
	    fetch(`/admin/${url}`)
	      .then(res => res.text())
	      .then(html => {
	        document.querySelector("#listTableDiv").innerHTML = html;
	        this.state.totalPageCount = document.getElementById('totalPageCount').value;
	        this.state.partial = false;
	        this.bindDeleteButtons();
	        this.changeList(this.state.totalPageCount);
	        this.bindUpdateButtons();
	        this.updateSortIcons();
	      });
	}
  },
  
  // ê²Œì‹œíŒ ìƒì„± ë²„íŠ¼ êµ¬í˜„
  createBoard() {
	  const container = document.getElementById("insertBoard")
	  const name = document.getElementById("boardName").value;
	    if (name.trim() === "") {
	      alert("ê²Œì‹œíŒ ì´ë¦„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”!");
	      return;
	    }
	    const params = {
	    	    sort: this.state.sort,
	    	    order: this.state.order,
	    	    page: this.state.page,
	    	    limit: this.state.limit,
	    	    url: this.state.url,
	    	    boardName: name
	    	  };

	    	  for (const key in params) {
	    	    const input = document.createElement('input');
	    	    input.type = 'hidden';
	    	    input.name = key;
	    	    input.value = params[key];
	    	    container.appendChild(input);
	    	  }
	    container.submit();
  },
	
	// ì‚­ì œ ë²„íŠ¼ ì´ë²¤íŠ¸ ajax ë˜ë©´ ë‹¤ì‹œ ë„£ì–´ì¤˜ì•¼
	bindDeleteButtons() {
	    document.querySelectorAll('.delete-button').forEach(button => {
	        button.addEventListener('click', function () {
	            const form = button.closest('form'); 
	            const id = form.querySelector('input[name="id"]').value;
	        	
	            if (!confirm(`idê°€ ${id}ì¸ í•­ëª©ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) {
	                return; 
	            }
	
	            const params = {
	                sort: TableManager.state.sort,
	                order: TableManager.state.order,
	                page: TableManager.state.page,
	                limit: TableManager.state.limit,
	                url: TableManager.state.url,
	                lastSorted: TableManager.state.lastSorted
	            };
	
	            const paramsInput = form.querySelector('input[name="params"]');
	            paramsInput.value = new URLSearchParams(params).toString();
	
	            form.submit();
	        });
	    });
	},
  
  // ìœ ì € ë“±ê¸‰ ë³€ê²½ ë©”ì†Œë“œ
  bindUpdateButtons() {
	    document.querySelectorAll('.update-button').forEach(button => {
	        button.addEventListener('click', function () {
	            const form = button.closest('form'); 
	            const id = form.querySelector('input[name="id"]').value;
	        	
	            const input = prompt(`${id}ë²ˆ íšŒì›ì˜ ìƒˆë¡œìš´ ë“±ê¸‰ì„ ìˆ«ì(1~10)ë¡œ ì ì–´ì£¼ì„¸ìš”`);

	            if (input === null || input.trim() === "") {
	              return;
	            } else if (isNaN(input)) {
	              alert("ìˆ«ìë§Œ ì…ë ¥í•´ì£¼ì„¸ìš”.");
	            } else if (!Number.isInteger(Number(input)) || input >10 || input < 1) {
	              alert("ì •ìˆ˜(1~10)ë§Œ ì…ë ¥í•´ì£¼ì„¸ìš”.");
	            } else {
	              const grade = parseInt(input);
	              
		          const params = {
			              sort: TableManager.state.sort,
			              order: TableManager.state.order,
			              page: TableManager.state.page,
			              limit: TableManager.state.limit,
			              url: TableManager.state.url,
			              lastSorted: TableManager.state.lastSorted
			          };
	
		          const paramsInput = form.querySelector('input[name="params"]');
		          paramsInput.value = new URLSearchParams(params).toString();
		          
		          form.querySelector('input[name="newGrade"]').value = grade;

		          form.submit();
	            }
	        });
	    });
	},
	// changeList, changePage, paging í˜ì´ì§€ ê´€ë ¨ ë©”ì†Œë“œ
	// ì‹¤ì œë¡œ í˜ì´ì§€ ë°”ë¥¼ ë§Œë“œëŠ” ë©”ì†Œë“œ
	changeList(pageCount) {
		let pagingtr =  document.getElementById("paging");
		
		totalPageCount = pageCount;

		let back = totalPageCount - 5 >= 1 ? totalPageCount - 5 : 1;
		let front = totalPageCount + 5 <= totalPageCount ? totalPageCount + 5 : totalPageCount
		        
		let backTo = back - 1 >= 1 ? back - 1 : 1;
		let frontTo = front + 1 <= totalPageCount ? front + 1 : totalPageCount;
		
        pagingtr.innerHTML = 
            `<td class='page-nav'>
                <a onclick="TableManager.changePage(${backTo})" class="page-link">&lt;&lt;</a>
            </td>` +
            this.paging(back, front) + 
            `<td class="page-nav">
                <a onclick="TableManager.changePage(${frontTo})" class="page-link">&gt;&gt;</a>
            </td>`;
	},
	// ë²„ë“ ì— ë“¤ì–´ê°€ëŠ” ë©”ì†Œë“œ í˜ì´ì§€ ë²ˆí˜¸ì— ë”°ë¼ ajax ë™ì‘
	changePage(movingPage) {
	    let page = document.getElementById("nowpage");
	    page.value = movingPage;
	    
	    this.state.page = movingPage - 1;
	    this.state.partial = true;
	    this.pageAjax();
	},
	// í˜ì´ì§€ ë²„íŠ¼ ë°˜ë³µ ìƒì„±
	paging(back, front) {
	    let page = "";
	    
	    for(let i = back; i <= front; i++) {
	    	if(i == document.getElementById("nowpage").value) {
	    		page += `
	    			  <td class="page-nav nowPage">
	    			    <a onclick="TableManager.changePage(${i})" class="page-link">${i}</a>
	    			  </td>
				`;
	    		continue;
	    	}
			page += `
			  <td class="page-nav">
			    <a onclick="TableManager.changePage(${i})" class="page-link">${i}</a>
			  </td>
			  `;
	    }
	    return page;
	},
	
	updateSortIcons() {
		const headers = document.querySelectorAll("thead th");
		  headers.forEach((th, index) => {
		    const direction = this.state.sortDirections?.[index]; // "asc", "desc" ë˜ëŠ” undefined
		    let icon = "";
			if (index == this.state.lastSorted){
			    if (direction === "asc") {
				      icon = " ğŸ”º"
				    } else if (direction === "desc") {
				      icon = " ğŸ”»";
				    }
			} else {
			    if (direction === "asc") {
			      icon = " ğŸ”¼";
			    } else if (direction === "desc") {
			      icon = " ğŸ”½";
			    }
			}
	
		    // ì •ë ¬ ì•„ì´ì½˜ ì¤‘ë³µ ë°©ì§€ë¥¼ ìœ„í•´ ê¸°ì¡´ í…ìŠ¤íŠ¸ì—ì„œ ì•„ì´ì½˜ ì œê±° í›„ ë‹¤ì‹œ ì¶”ê°€
		    const baseText = th.textContent.replace(/[ğŸ”¼ğŸ”½ğŸ”ºğŸ”»]/g, "").trim(); // ğŸ”¼, ğŸ”½ ì œê±°
		    th.textContent = baseText + icon;
		  });
	}
};
// ì´ˆê¸°í™”
TableManager.init("users",["id", "nickname", "email", "reg_date", "last_access_date", "user_grade"]);
</script>
</head>
<body>
    <nav>
      <div class="nav-links">
        <a href="/" class="active"><i class="fas fa-home"></i> í™ˆ</a>
        <a href="/board/list"><i class="fas fa-list"></i> ê²Œì‹œíŒ</a>
        <a href="/file/read?note_id=1"><i class="fas fa-upload"></i> íŒŒì¼ ì—…ë¡œë“œ</a>
        <a href="/login" th:if="${session.loginMember == null}"><i class="fas fa-sign-in-alt"></i> ë¡œê·¸ì¸</a>
        <a href="/register" th:if="${session.loginMember == null}"><i class="fas fa-user-plus"></i> íšŒì›ê°€ì…</a>
        <a href="/logout" th:if="${session.loginMember != null}"><i class="fas fa-sign-out-alt"></i> ë¡œê·¸ì•„ì›ƒ</a>
        <a href="/admin"><i class="fas fa-cog"></i> ê´€ë¦¬ì</a>
      </div>
    </nav>
    <hr>
    <nav>
		<a href="#" onclick="TableManager.set('users', ['id', 'nickname', 'email', 'reg_date', 'last_access_date', 'user_grade'])">íšŒì›</a> | 
		<a href="#" onclick="TableManager.set('boards', ['id', 'name', 'create_date', 'last_modified_date'])">ê²Œì‹œíŒ</a> | 
		<a href="#" onclick="TableManager.set('notes', ['id', 'title', 'content', 'create_date', 'last_modified_date', 'board_id', 'user_id'])">ê²Œì‹œê¸€</a> | 
		<a href="#" onclick="TableManager.set('comments', ['id', 'content', 'create_date', 'last_modified_date', 'comment_id', 'note_id', 'comment_author_id'])">ëŒ“ê¸€</a> | 
		<a href="#" onclick="TableManager.set('files', ['id', 'filename', 'files', 'note_id'])">íŒŒì¼</a>
    </nav>
    <div id="listTableDiv">
    <h2>íšŒì› ëª©ë¡</h2>
    <div class="control-bar"><div></div>
    <select id="pageLimitSelect" onchange="TableManager.updateLimitSize(this.value)" >
      <option value="0" selected="selected" disabled="disabled">=== ì •ë ¬ ê°œìˆ˜ ì„ íƒ ===</option>
	  <option value="10">10</option>
	  <option value="20">20</option>
	  <option value="50">50</option>
	  <option value="100">100</option>
	</select>
	</div>
    <table border="1">
        <thead><th onclick="TableManager.updateSort(0)">íšŒì› ë²ˆí˜¸</th><th onclick="TableManager.updateSort(1)">ì´ë¦„</th>
        	<th onclick="TableManager.updateSort(2)">ì´ë©”ì¼</th><th onclick="TableManager.updateSort(3)">ê°€ì…ì¼</th>
        	<th onclick="TableManager.updateSort(4)">ë§ˆì§€ë§‰ ì ‘ì†ì¼</th><th onclick="TableManager.updateSort(5)">ë“±ê¸‰</th>
        	<th>ë“±ê¸‰ ë³€ê²½</th><th>ì‚­ì œ</th></thead>
        <tbody>
		        <tr th:each="item: ${users}">
		        	<td th:text="${item.id}"></td>
		        	<td th:text="${item.nickName}"></td>
		        	<td th:text="${item.email}"></td>
			     	<td th:text="${#temporals.format(item.regDate, 'yy-MM-dd HH:mm:ss')}"></td>
			     	<td th:text="${#temporals.format(item.lastAccessDate, 'yy-MM-dd HH:mm:ss')}"></td>
		        	<td th:text="${item.userGrade}"></td>
		        	<td>
		        		<form class="update-grade" action="/admin/users/updateGrade" method="post">
		        			<input type="hidden" name="id" th:value="${item.id}" />
		        			<input type="hidden" name="newGrade" />
		        			<input type="hidden" name="params"/>
				        	<button type="button" class="update-button">ë“±ê¸‰ ë³€ê²½</button>
		        		</form>
		        	</td>
		        	<td>
		        		<form class="delete-form" action="/admin/users/delete" method="post">
		        			<input type="hidden" name="id" th:value="${item.id}" />
		        			<input type="hidden" name="params"/>
				        	<button type="button" class="delete-button">ì‚­ì œ</button>
		        		</form>
		        	</td>
		        </tr>
        </tbody>
    </table>
    </div>
   	<input id="nowpage" value=1 hidden="hidden">
    <table>
	    <tr id="paging">
	    </tr>
    </table>
<script th:inline="javascript">
TableManager.changeList([[${totalPageCount}]]);

// ì‚­ì œí•˜ê³  ëŒì•„ì™”ì„ ë•Œ í˜ì´ì§€ ê·¸ëŒ€ë¡œ ë³´ì´ê²Œ ì‘ë™
window.onload = function() {
	TableManager.updateSortIcons();
	const urlParams = new URLSearchParams(window.location.search);
	
	const defaultUrl = urlParams.get('url');
	if (defaultUrl) {
		if (defaultUrl === "users") {
			TableManager.state.page = urlParams.get('page');
			TableManager.state.limit = urlParams.get('limit');
			TableManager.state.order = urlParams.get('order');
			TableManager.state.sort = urlParams.get('sort');
		    TableManager.state.url = defaultUrl;
			TableManager.set('users', ['id', 'nickname', 'email', 'reg_date', 'last_access_date', 'user_grade']);
		} else if (defaultUrl === "boards") {
			TableManager.state.page = urlParams.get('page');
			TableManager.state.limit = urlParams.get('limit');
			TableManager.state.order = urlParams.get('order');
			TableManager.state.sort = urlParams.get('sort');
		    TableManager.state.url = defaultUrl;
			TableManager.set('boards', ['id', 'name', 'create_date', 'last_modified_date']);
		} else if (defaultUrl === "notes") {
			TableManager.state.page = urlParams.get('page');
			TableManager.state.limit = urlParams.get('limit');
			TableManager.state.order = urlParams.get('order');
			TableManager.state.sort = urlParams.get('sort');
		    TableManager.state.url = defaultUrl;
			TableManager.set('notes', ['id', 'title', 'content', 'create_date', 'last_modified_date', 'board_id', 'user_id'])
		} else if (defaultUrl === "comments") {
			TableManager.state.page = urlParams.get('page');
			TableManager.state.limit = urlParams.get('limit');
			TableManager.state.order = urlParams.get('order');
			TableManager.state.sort = urlParams.get('sort');
		    TableManager.state.url = defaultUrl;
			TableManager.set('comments', ['id', 'content', 'create_date', 'last_modified_date', 'comment_id', 'note_id', 'comment_author_id'])
		} else if (defaultUrl === "files") {
			TableManager.state.page = urlParams.get('page');
			TableManager.state.limit = urlParams.get('limit');
			TableManager.state.order = urlParams.get('order');
			TableManager.state.sort = urlParams.get('sort');
		    TableManager.state.url = defaultUrl;
		    TableManager.set('files', ['id', 'filename', 'files', 'note_id']);
		} else {
			confirm('url í™•ì¸ í•„ìš”');
		}
	}
}
</script>
</body>
</html>
  -->

<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>íšŒì› ê´€ë¦¬</title>
    <link href="https://fonts.googleapis.com/css2?family=Pretendard:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary: #6A5ACD;
            --primary-light: #E6E4FF;
            --accent: #FF6B6B;
            --background: #F9F9F9;
            --card-bg: #FFFFFF;
            --text: #333333;
            --text-light: #666666;
            --border: #E0E0E0;
            --shadow: 0 4px 12px rgba(0,0,0,0.08);
            --radius: 12px;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Pretendard', sans-serif;
            background-color: var(--background);
            color: var(--text);
            line-height: 1.6;
        }

        header {
            background-color: var(--card-bg);
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        nav {
            max-width: 1200px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 20px;
        }

        .logo {
            font-size: 24px;
            font-weight: 700;
            color: var(--primary);
            text-decoration: none;
        }

        .nav-links {
            display: flex;
            gap: 5px;
        }

        nav a {
            text-decoration: none;
            color: var(--text);
            padding: 8px 16px;
            border-radius: var(--radius);
            font-weight: 500;
            transition: all 0.2s ease;
        }

        nav a:hover {
            background-color: var(--primary-light);
            color: var(--primary);
        }

        .active {
            background-color: var(--primary);
            color: white;
        }

        .container {
            max-width: 1200px;
            margin: 30px auto;
            padding: 0 20px;
        }
        
        #insertBoard {
	      display: flex;
	      gap: 10px;
	    }
	
	    input[type="text"] {
	      padding: 10px;
	      border: 1px solid var(--border);
	      border-radius: var(--radius);
	      width: 250px;
	      font-family: 'Pretendard', sans-serif;
	    }
        
	    button {
	      background-color: var(--primary);
	      color: white;
	      border: none;
	      padding: 10px 15px;
	      border-radius: var(--radius);
	      font-weight: 500;
	      cursor: pointer;
	      transition: background-color 0.2s;
	      font-family: 'Pretendard', sans-serif;
	      display: flex;
	      align-items: center;
	      justify-content: center;
	    }

        .admin-nav {
            background-color: var(--card-bg);
            border-radius: var(--radius);
            padding: 12px 20px;
            box-shadow: var(--shadow);
            margin-bottom: 20px;
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }

        .admin-nav a {
            text-decoration: none;
            color: var(--text);
            padding: 8px 16px;
            border-radius: var(--radius);
            font-weight: 500;
            transition: all 0.2s ease;
        }

        .admin-nav a:hover {
            background-color: var(--primary-light);
            color: var(--primary);
        }

        .admin-nav a.active {
            background-color: var(--primary);
            color: white;
        }

        .section-title {
            display: flex;
            align-items: center;
            margin-bottom: 24px;
            font-size: 22px;
            font-weight: 700;
            color: var(--primary);
        }

        .section-title i {
            margin-right: 12px;
            background-color: var(--primary-light);
            color: var(--primary);
            border-radius: 50%;
            padding: 8px;
            font-size: 18px;
        }

        .control-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        select {
            padding: 10px 15px;
            border-radius: var(--radius);
            border: 1px solid var(--border);
            background-color: var(--card-bg);
            font-family: 'Pretendard', sans-serif;
            font-size: 14px;
            color: var(--text);
            cursor: pointer;
            transition: all 0.2s ease;
        }

        select:hover {
            border-color: var(--primary);
        }

        table {
            width: 100%;
            border-collapse: collapse;
            background-color: var(--card-bg);
            border-radius: var(--radius);
            overflow: hidden;
            box-shadow: var(--shadow);
            margin-bottom: 20px;
        }

        th, td {
            padding: 12px 15px;
            text-align: center;
            border-bottom: 1px solid var(--border);
        }

        th {
            background-color: var(--primary-light);
            color: var(--primary);
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        th:hover {
            background-color: #D9D6FF;
        }

        tr:last-child td {
            border-bottom: none;
        }

        tr:hover {
            background-color: rgba(106, 90, 205, 0.05);
        }

        .update-button {
            background-color: var(--primary);
            color: white;
            border: none;
            padding: 8px 12px;
            border-radius: var(--radius);
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
            font-family: 'Pretendard', sans-serif;
        }

        .update-button:hover {
            background-color: #5849b8;
            transform: translateY(-2px);
        }

        .delete-button {
            background-color: var(--accent);
            color: white;
            border: none;
            padding: 8px 12px;
            border-radius: var(--radius);
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
            font-family: 'Pretendard', sans-serif;
        }

        .delete-button:hover {
            background-color: #ff5252;
            transform: translateY(-2px);
        }

        .page-nav {
            padding: 8px;
        }

        .page-link {
            text-decoration: none;
            color: var(--primary);
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .page-link:hover {
            color: #5849b8;
        }

        .nowPage a {
            color: white;
            background-color: var(--primary);
            padding: 8px 12px;
            border-radius: var(--radius);
        }
        
        table a {
        	display: block; width: 100%;
        }

        .loading-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }

        .spinner {
            width: 40px;
            height: 40px;
            border: 4px solid rgba(255,255,255,0.3);
            border-radius: 50%;
            border-top-color: white;
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        @media (max-width: 768px) {
            .nav-links {
                display: none;
            }
            
            .admin-nav {
                flex-direction: column;
                align-items: flex-start;
            }
        }
    </style>
    <script th:inline="javascript">
    const TableManager = {
      state: {
        sortDirections: [], // ê° ì»¬ëŸ¼ì˜ ì •ë ¬ ë°©í–¥ ('asc' or 'desc')
        sortName: [],       // ì»¬ëŸ¼ ì´ë¦„ ë°°ì—´ (ì„œë²„ì—ì„œ ì“°ì´ëŠ” ì»¬ëŸ¼ëª…)
        lastSorted: 0,		// ë§ˆì§€ë§‰ìœ¼ë¡œ í´ë¦­ëœ ì»¬ëŸ¼ ë²ˆí˜¸
        page: 0,            // í˜„ì¬ í˜ì´ì§€ ë²ˆí˜¸
        limit: 20,          // í•œ í˜ì´ì§€ì— ëª‡ ê°œë¥¼ ë³´ì—¬ì¤„ì§€
        order: "asc",       // í˜„ì¬ ì •ë ¬ ë°©í–¥
        sort: "id",         // í˜„ì¬ ì •ë ¬ ê¸°ì¤€ ì»¬ëŸ¼
        partial: false,		// í…Œì´ë¸” ì „ì²´(ì»¬ëŸ¼)ë¥¼ ë°”ê¿€ì§€ ì•„ë‹ˆë©´ tbodyë§Œ ë°”ê¿€ì§€
        boardName: null, // board ì´ë¦„ ë°›ì•„ì„œ ìƒì„±
        url: "users",		// ë¬´ì—‡ì— ê´€í•œ í…Œì´ë¸”ì¸ì§€
        totalPageCount: -1	// í˜ì´ì§€ ëª‡ê¹Œì§€ ìˆë‚˜, ì´ˆê¸°í™” -1
      },

      // admin.html ì²˜ìŒ ë“¤ì–´ì˜¬ ë•Œ ì´ˆê¸°í™”
      init(url, sortNameArray) {
        this.state.sortName = sortNameArray;
        this.state.sortDirections = new Array(sortNameArray.length).fill("asc");
        this.state.sort = sortNameArray[0];
        this.state.order = "asc";
        this.state.url = url;
        
        document.addEventListener('DOMContentLoaded', () => {
            this.bindDeleteButtons();
        });
      },
      // í…Œì´ë¸” ì¢…ë¥˜ë¥¼ ë°”ê¿€ ë•Œ ë™ì‘ > ajaxë¡œ ë™ì‘
      set(url, sortNameArray) {
        this.state.sortName = sortNameArray;
        this.state.sortDirections = new Array(sortNameArray.length).fill("asc");
        this.state.lastSorted = 0;
        this.state.page = 0;
        this.state.limit = 20;
        this.state.order = "asc";
        this.state.sort = sortNameArray[0];
        this.state.url = url;
        
        this.pageAjax();
      },
      // select option ë³€ê²½ë  ë•Œ
      updateLimitSize(newsize) {
            console.log("newsize: ", newsize);
        if (newsize == 0) {
            console.log("ì‚¬ì´ì¦ˆ ë³€ê²½ ì—†ìŒ");
            return false;
        }
        this.state.limit = newsize;
        this.state.partial = true;
        
        this.pageAjax();
      },
      // ì¹¼ëŸ¼ì„ ëˆ„ë¥´ë©´ ì˜¤ë¦„ì°¨ìˆœ ë‚´ë¦¼ì°¨ìˆœ ë°”ë€œ > ajax
      updateSort(col) {
        this.state.lastSorted = col;
        if (this.state.sortDirections[col] === "desc") {
            this.state.sortDirections[col] = "asc";
        } else if (this.state.sortDirections.includes("desc")) {
            this.state.sortDirections = new Array(this.state.sortName.length).fill("asc");
        } else {
            this.state.sortDirections = new Array(this.state.sortName.length).fill("asc");
            this.state.sortDirections[col] = "desc";
        }
        
        this.state.partial = true;
        this.state.sort = this.state.sortName[col];
        this.state.order = this.state.sortDirections[col];

        this.pageAjax();
      },
      // ajax ë™ì‘ì— ê´€í•œ í•¨ìˆ˜ ì •ë³´ ë°›ì•„ì˜¤ê³  ë³€ìˆ˜ ì •ë¦¬
      pageAjax() {
        const { sort, order, page, limit, url, boardName } = this.state;
        if (this.state.partial) {
            fetch(`/admin/${url}/partial?sortby=${sort}&orderby=${order}&page=${page}&limit=${limit}&url=${url}`)
              .then(res => res.text())
              .then(html => {
                document.querySelector("tbody").innerHTML = html;
                this.state.totalPageCount = document.getElementById('totalPageCount').value;
                this.state.partial = false;
                this.bindDeleteButtons();
                this.changeList(this.state.totalPageCount < 0 ? [[${totalPageCount}]] : this.state.totalPageCount);
                this.bindUpdateButtons();
                this.updateSortIcons();
              });
        } else {
            fetch(`/admin/${url}?page=0&limit=20&url=${url}`)
              .then(res => res.text())
              .then(html => {
                document.querySelector("#listTableDiv").innerHTML = html;
                this.state.totalPageCount = document.getElementById('totalPageCount').value;
                this.state.partial = false;
                this.bindDeleteButtons();
                this.changeList(this.state.totalPageCount < 0 ? [[${totalPageCount}]] : this.state.totalPageCount);
                this.changePage(1);
                this.state.page = 0;
                this.bindUpdateButtons();
                this.updateSortIcons();
              });
        }
      },
      
      // ê²Œì‹œíŒ ìƒì„± ë²„íŠ¼ êµ¬í˜„
      createBoard() {
          const container = document.getElementById("insertBoard")
          const name = document.getElementById("boardName").value;
            if (name.trim() === "") {
              alert("ê²Œì‹œíŒ ì´ë¦„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”!");
              return;
            }
            const params = {
                    sort: this.state.sort,
                    order: this.state.order,
                    page: this.state.page,
                    limit: this.state.limit,
                    url: this.state.url,
                    boardName: name
                  };

                  for (const key in params) {
                    const input = document.createElement('input');
                    input.type = 'hidden';
                    input.name = key;
                    input.value = params[key];
                    container.appendChild(input);
                  }
            container.submit();
      },
        
        // ì‚­ì œ ë²„íŠ¼ ì´ë²¤íŠ¸ ajax ë˜ë©´ ë‹¤ì‹œ ë„£ì–´ì¤˜ì•¼
        bindDeleteButtons() {
            document.querySelectorAll('.delete-button').forEach(button => {
                button.addEventListener('click', function () {
                    const form = button.closest('form'); 
                    const id = form.querySelector('input[name="id"]').value;
                    
                    if (!confirm(`idê°€ ${id}ì¸ í•­ëª©ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) {
                        return; 
                    }
        
                    const params = {
                        sort: TableManager.state.sort,
                        order: TableManager.state.order,
                        page: TableManager.state.page,
                        limit: TableManager.state.limit,
                        url: TableManager.state.url,
                        lastSorted: TableManager.state.lastSorted
                    };
        
                    const paramsInput = form.querySelector('input[name="params"]');
                    paramsInput.value = new URLSearchParams(params).toString();
        
                    form.submit();
                });
            });
        },
      
      // ìœ ì € ë“±ê¸‰ ë³€ê²½ ë©”ì†Œë“œ
      bindUpdateButtons() {
            document.querySelectorAll('.update-button').forEach(button => {
                button.addEventListener('click', function () {
                    const form = button.closest('form'); 
                    const id = form.querySelector('input[name="id"]').value;
                    
                    const input = prompt(`${id}ë²ˆ íšŒì›ì˜ ìƒˆë¡œìš´ ë“±ê¸‰ì„ ìˆ«ì(1~10)ë¡œ ì ì–´ì£¼ì„¸ìš”`);

                    if (input === null || input.trim() === "") {
                      return;
                    } else if (isNaN(input)) {
                      alert("ìˆ«ìë§Œ ì…ë ¥í•´ì£¼ì„¸ìš”.");
                    } else if (!Number.isInteger(Number(input)) || input >10 || input < 1) {
                      alert("ì •ìˆ˜(1~10)ë§Œ ì…ë ¥í•´ì£¼ì„¸ìš”.");
                    } else {
                      const grade = parseInt(input);
                      
                      const params = {
                          sort: TableManager.state.sort,
                          order: TableManager.state.order,
                          page: TableManager.state.page,
                          limit: TableManager.state.limit,
                          url: TableManager.state.url,
                          lastSorted: TableManager.state.lastSorted
                      };
        
                      const paramsInput = form.querySelector('input[name="params"]');
                      paramsInput.value = new URLSearchParams(params).toString();
                      
                      form.querySelector('input[name="newGrade"]').value = grade;

                      form.submit();
                    }
                });
            });
        },
        // changeList, changePage, paging í˜ì´ì§€ ê´€ë ¨ ë©”ì†Œë“œ
        // ì‹¤ì œë¡œ í˜ì´ì§€ ë°”ë¥¼ ë§Œë“œëŠ” ë©”ì†Œë“œ
        changeList(pageCount) {
            let pagingtr =  document.getElementById("paging");
            
            totalPageCount = pageCount;

            let back = totalPageCount - 5 >= 1 ? totalPageCount - 5 : 1;
            let front = totalPageCount + 5 <= totalPageCount ? totalPageCount + 5 : totalPageCount
                    
            let backTo = back - 1 >= 1 ? back - 1 : 1;
            let frontTo = front + 1 <= totalPageCount ? front + 1 : totalPageCount;
            
            pagingtr.innerHTML = 
                `<td class='page-nav'>
                    <a onclick="TableManager.changePage(${backTo})" class="page-link">&lt;&lt;</a>
                </td>` +
                this.paging(back, front) + 
                `<td class="page-nav">
                    <a onclick="TableManager.changePage(${frontTo})" class="page-link">&gt;&gt;</a>
                </td>`;
        },
        // ë²„ë“ ì— ë“¤ì–´ê°€ëŠ” ë©”ì†Œë“œ í˜ì´ì§€ ë²ˆí˜¸ì— ë”°ë¼ ajax ë™ì‘
        changePage(movingPage) {
            let page = document.getElementById("nowpage");
            page.value = movingPage;
            
            this.state.page = movingPage - 1;
            this.state.partial = true;
            this.pageAjax();
        },
        // í˜ì´ì§€ ë²„íŠ¼ ë°˜ë³µ ìƒì„±
        paging(back, front) {
            let page = "";
            
            for(let i = back; i <= front; i++) {
                if(i == document.getElementById("nowpage").value) {
                    page += `
                          <td class="page-nav nowPage">
                            <a onclick="TableManager.changePage(${i})" class="page-link">${i}</a>
                          </td>
                    `;
                    continue;
                }
                page += `
                  <td class="page-nav">
                    <a onclick="TableManager.changePage(${i})" class="page-link">${i}</a>
                  </td>
                  `;
            }
            return page;
        },
        
        updateSortIcons() {
            const headers = document.querySelectorAll("thead th");
              headers.forEach((th, index) => {
                const direction = this.state.sortDirections?.[index]; // "asc", "desc" ë˜ëŠ” undefined
                let icon = "";
                if (index == this.state.lastSorted){
                    if (direction === "asc") {
                          icon = " ğŸ”º"
                        } else if (direction === "desc") {
                          icon = " ğŸ”»";
                        }
                } else {
                    if (direction === "asc") {
                      icon = " ğŸ”¼";
                    } else if (direction === "desc") {
                      icon = " ğŸ”½";
                    }
                }
        
                // ì •ë ¬ ì•„ì´ì½˜ ì¤‘ë³µ ë°©ì§€ë¥¼ ìœ„í•´ ê¸°ì¡´ í…ìŠ¤íŠ¸ì—ì„œ ì•„ì´ì½˜ ì œê±° í›„ ë‹¤ì‹œ ì¶”ê°€
                const baseText = th.textContent.replace(/[ğŸ”¼ğŸ”½ğŸ”ºğŸ”»]/g, "").trim(); // ğŸ”¼, ğŸ”½ ì œê±°
                th.textContent = baseText + icon;
              });
        }
    };
    // ì´ˆê¸°í™”
    TableManager.init("users",["id", "nickname", "email", "reg_date", "last_access_date", "user_grade"]);
    </script>
</head>
<body>
    <div id="loadingModal" class="loading-modal" style="display: none;">
        <div class="spinner"></div>
    </div>

    <header>
        <nav>
            <a href="/" class="logo">ì»¤ë®¤ë‹ˆí‹°</a>
            <div class="nav-links">
                <a href="/"><i class="fas fa-home"></i> í™ˆ</a>
                <a href="/board/list"><i class="fas fa-list"></i> ê²Œì‹œíŒ</a>
                <a href="/login" th:if="${session.loginMember == null}"><i class="fas fa-sign-in-alt"></i> ë¡œê·¸ì¸</a>
                <a href="/register" th:if="${session.loginMember == null}"><i class="fas fa-user-plus"></i> íšŒì›ê°€ì…</a>
                <a href="/logout" th:if="${session.loginMember != null}"><i class="fas fa-sign-out-alt"></i> ë¡œê·¸ì•„ì›ƒ</a>
                <a href="/admin" class="active"><i class="fas fa-cog"></i> ê´€ë¦¬ì</a>
            </div>
        </nav>
    </header>

    <div class="container">
        <div class="admin-nav">
            <a href="#" onclick="TableManager.set('users', ['id', 'nickname', 'email', 'reg_date', 'last_access_date', 'user_grade'])"><i class="fas fa-users"></i> íšŒì›</a>
            <a href="#" onclick="TableManager.set('boards', ['id', 'name', 'create_date', 'last_modified_date'])"><i class="fas fa-clipboard-list"></i> ê²Œì‹œíŒ</a>
            <a href="#" onclick="TableManager.set('notes', ['id', 'title', 'content', 'create_date', 'last_modified_date', 'board_id', 'user_id'])"><i class="fas fa-pen-fancy"></i> ê²Œì‹œê¸€</a>
            <a href="#" onclick="TableManager.set('comments', ['id', 'content', 'create_date', 'last_modified_date', 'comment_id', 'note_id', 'comment_author_id'])"><i class="fas fa-comments"></i> ëŒ“ê¸€</a>
            <a href="#" onclick="TableManager.set('files', ['id', 'filename', 'files', 'note_id'])"><i class="fas fa-file-upload"></i> íŒŒì¼</a>
        </div>

        <div id="listTableDiv">
            <h2 class="section-title"><i class="fas fa-users"></i> íšŒì› ëª©ë¡</h2>
            <div class="control-bar">
                <div></div>
                <select id="pageLimitSelect" onchange="TableManager.updateLimitSize(this.value)">
                    <option value="0" selected="selected" disabled="disabled">=== ì •ë ¬ ê°œìˆ˜ ì„ íƒ ===</option>
                    <option value="10">10</option>
                    <option value="20">20</option>
                    <option value="50">50</option>
                    <option value="100">100</option>
                </select>
            </div>
            <table>
                <thead>
                    <th onclick="TableManager.updateSort(0)">íšŒì› ë²ˆí˜¸</th>
                    <th onclick="TableManager.updateSort(1)">ì´ë¦„</th>
                    <th onclick="TableManager.updateSort(2)">ì´ë©”ì¼</th>
                    <th onclick="TableManager.updateSort(3)">ê°€ì…ì¼</th>
                    <th onclick="TableManager.updateSort(4)">ë§ˆì§€ë§‰ ì ‘ì†ì¼</th>
                    <th onclick="TableManager.updateSort(5)">ë“±ê¸‰</th>
                    <th>ë“±ê¸‰ ë³€ê²½</th>
                    <th>ì‚­ì œ</th>
                </thead>
                <tbody>
                    <tr th:each="item: ${users}">
                        <td th:text="${item.id}"></td>
                        <td th:text="${item.nickName}"></td>
                        <td th:text="${item.email}"></td>
                        <td th:text="${#temporals.format(item.regDate, 'yy-MM-dd HH:mm:ss')}"></td>
                        <td th:text="${#temporals.format(item.lastAccessDate, 'yy-MM-dd HH:mm:ss')}"></td>
                        <td th:text="${item.userGrade}"></td>
                        <td>
                            <form class="update-grade" action="/admin/users/updateGrade" method="post">
                                <input type="hidden" name="id" th:value="${item.id}" />
                                <input type="hidden" name="newGrade" />
                                <input type="hidden" name="params"/>
                                <button type="button" class="update-button"><i class="fas fa-edit"></i>ë“±ê¸‰ ë³€ê²½</button>
                            </form>
                        </td>
                        <td>
                            <form class="delete-form" action="/admin/users/delete" method="post">
                                <input type="hidden" name="id" th:value="${item.id}" />
                                <input type="hidden" name="params"/>
                                <button type="button" class="delete-button">ì‚­ì œ</button>
                            </form>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
        <input id="nowpage" value=1 hidden="hidden">
        <table>
            <tr id="paging">
            </tr>
        </table>
    </div>

    <script th:inline="javascript">

    // ì‚­ì œí•˜ê³  ëŒì•„ì™”ì„ ë•Œ í˜ì´ì§€ ê·¸ëŒ€ë¡œ ë³´ì´ê²Œ ì‘ë™
    window.onload = function() {
        TableManager.updateSortIcons();
        TableManager.changeList(TableManager.state.totalPageCount < 0 ? [[${totalPageCount}]] : TableManager.state.totalPageCount);
        const urlParams = new URLSearchParams(window.location.search);
        
        const defaultUrl = urlParams.get('url');
        if (defaultUrl) {
            if (defaultUrl === "users") {
                TableManager.state.page = urlParams.get('page');
                TableManager.state.limit = urlParams.get('limit');
                TableManager.state.order = urlParams.get('order');
                TableManager.state.sort = urlParams.get('sort');
                TableManager.state.url = defaultUrl;
                TableManager.set('users', ['id', 'nickname', 'email', 'reg_date', 'last_access_date', 'user_grade']);
            } else if (defaultUrl === "boards") {
                TableManager.state.page = urlParams.get('page');
                TableManager.state.limit = urlParams.get('limit');
                TableManager.state.order = urlParams.get('order');
                TableManager.state.sort = urlParams.get('sort');
                TableManager.state.url = defaultUrl;
                TableManager.set('boards', ['id', 'name', 'create_date', 'last_modified_date']);
            } else if (defaultUrl === "notes") {
                TableManager.state.page = urlParams.get('page');
                TableManager.state.limit = urlParams.get('limit');
                TableManager.state.order = urlParams.get('order');
                TableManager.state.sort = urlParams.get('sort');
                TableManager.state.url = defaultUrl;
                TableManager.set('notes', ['id', 'title', 'content', 'create_date', 'last_modified_date', 'board_id', 'user_id'])
            } else if (defaultUrl === "comments") {
                TableManager.state.page = urlParams.get('page');
                TableManager.state.limit = urlParams.get('limit');
                TableManager.state.order = urlParams.get('order');
                TableManager.state.sort = urlParams.get('sort');
                TableManager.state.url = defaultUrl;
                TableManager.set('comments', ['id', 'content', 'create_date', 'last_modified_date', 'comment_id', 'note_id', 'comment_author_id'])
            } else if (defaultUrl === "files") {
                TableManager.state.page = urlParams.get('page');
                TableManager.state.limit = urlParams.get('limit');
                TableManager.state.order = urlParams.get('order');
                TableManager.state.sort = urlParams.get('sort');
                TableManager.state.url = defaultUrl;
                TableManager.set('files', ['id', 'filename', 'files', 'note_id']);
            } else {
                confirm('url í™•ì¸ í•„ìš”');
            }
        }
    }
    </script>
</body>
</html>